<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Monitoring Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stat-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .stat-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .stat-card.info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        .interview-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .status-badge {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-chart-line"></i> Interview Monitoring Dashboard
                </h1>
                <p class="text-center text-muted">Real-time monitoring of concurrent interviews</p>
            </div>
        </div>

        <!-- System Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card info">
                    <div class="stat-number" id="uptime-hours">0</div>
                    <div class="stat-label">System Uptime (Hours)</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card success">
                    <div class="stat-number" id="total-requests">0</div>
                    <div class="stat-label">Total Requests</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card warning">
                    <div class="stat-number" id="error-rate">0%</div>
                    <div class="stat-label">Error Rate</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number" id="requests-per-minute">0</div>
                    <div class="stat-label">Requests/Minute</div>
                </div>
            </div>
        </div>

        <!-- Interview Statistics -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stat-card success">
                    <div class="stat-number" id="active-interviews">0</div>
                    <div class="stat-label">Active Interviews</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card info">
                    <div class="stat-number" id="total-completed">0</div>
                    <div class="stat-label">Total Completed</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number" id="avg-duration">0</div>
                    <div class="stat-label">Avg Duration (Min)</div>
                </div>
            </div>
        </div>

        <!-- Connection Pool Stats -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-database"></i> Connection Pool Statistics</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Active Connections:</strong> <span id="active-connections">0</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Pool Size:</strong> <span id="pool-size">0</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Max Connections:</strong> <span id="max-connections">0</span>
                            </div>
                            <div class="col-md-3">
                                <strong>Utilization:</strong> <span id="pool-utilization">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Interviews -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users"></i> Active Interviews</h5>
                    </div>
                    <div class="card-body">
                        <div class="interview-list" id="active-interview-list">
                            <p class="text-muted text-center">No active interviews</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Refresh Button -->
        <button class="btn btn-primary refresh-btn" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function updateDashboard(data) {
            // System stats
            document.getElementById('uptime-hours').textContent = data.system.uptime_hours;
            document.getElementById('total-requests').textContent = data.system.total_requests;
            document.getElementById('error-rate').textContent = data.system.error_rate_percent + '%';
            document.getElementById('requests-per-minute').textContent = data.system.requests_per_minute;

            // Interview stats
            document.getElementById('active-interviews').textContent = data.interviews.active_interviews;
            document.getElementById('total-completed').textContent = data.interviews.total_completed;
            document.getElementById('avg-duration').textContent = data.interviews.average_duration_minutes;

            // Connection pool stats
            const pool = data.system.connection_pool;
            document.getElementById('active-connections').textContent = pool.active_connections;
            document.getElementById('pool-size').textContent = pool.pool_size;
            document.getElementById('max-connections').textContent = pool.max_connections;
            const utilization = pool.max_connections > 0 ? 
                Math.round((pool.active_connections / pool.max_connections) * 100) : 0;
            document.getElementById('pool-utilization').textContent = utilization + '%';

            // Active interviews list
            const interviewList = document.getElementById('active-interview-list');
            const activeInterviews = data.active_interviews;
            
            if (Object.keys(activeInterviews).length === 0) {
                interviewList.innerHTML = '<p class="text-muted text-center">No active interviews</p>';
            } else {
                let html = '<div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>User ID</th><th>Questions</th><th>Duration</th><th>Last Activity</th><th>Status</th></tr></thead><tbody>';
                
                for (const [userId, interview] of Object.entries(activeInterviews)) {
                    const duration = Math.round((new Date() - new Date(interview.start_time)) / 1000 / 60);
                    const lastActivity = Math.round((new Date() - new Date(interview.last_activity)) / 1000 / 60);
                    
                    html += `<tr>
                        <td><strong>${userId}</strong></td>
                        <td>${interview.questions_answered}/${interview.total_questions}</td>
                        <td>${duration} min</td>
                        <td>${lastActivity} min ago</td>
                        <td><span class="badge bg-success status-badge">${interview.status}</span></td>
                    </tr>`;
                }
                
                html += '</tbody></table></div>';
                interviewList.innerHTML = html;
            }
        }

        function refreshData() {
            fetch('/api/monitoring/stats')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                })
                .catch(error => {
                    console.error('Error fetching monitoring data:', error);
                });
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);

        // Initial load
        refreshData();
    </script>
</body>
</html>
